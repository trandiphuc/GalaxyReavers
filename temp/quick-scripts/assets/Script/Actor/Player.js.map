{"version":3,"sources":["Player.js"],"names":["mEmitter","require","cc","Class","extends","Component","properties","maxSpeed","level","explodeFx","SpriteFrame","onLoad","node","_parent","name","_tmpPos","position","Canvas","instance","on","Node","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","event","touches","getTouches","moving","getDelta","addSelf","onCollisionEnter","other","self","group","die","tween","call","getComponent","Sprite","spriteFrame","delay","destroy","loadScreenGameOver","start","parent","getChildByName","getLevelIndex","director","loadScene","log","emit","getLevelScore","getScene","setLevel","update","dt","currentPos","delta","sub","distance","magSqr","maxSpeedPerFrame","normalizeSelf","mulSelf","add","screen","getContentSize","x","misc","clampf","width","y","height","onDestroy","off"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Actor","sourcesContent":["const mEmitter = require(\"Emitter\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        maxSpeed: 10,\r\n        level: \"\",\r\n        explodeFx: cc.SpriteFrame,\r\n    },\r\n\r\n    onLoad() {\r\n        this.level = this.node._parent.name;\r\n        this._tmpPos = this.node.position;\r\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    },\r\n\r\n    onTouchMove(event) {\r\n        let touches = event.getTouches();\r\n        let moving = touches[0].getDelta();\r\n        this._tmpPos.addSelf(moving);\r\n    },\r\n\r\n    onTouchEnd() {\r\n        this._tmpPos = this.node.position;\r\n    },\r\n\r\n    onCollisionEnter(other, self) {\r\n        if (other.node.group === 'enemy' || other.node.group === 'enemy_bullet') {\r\n            this.die();\r\n        }\r\n    },\r\n\r\n    die() {  \r\n        cc.tween(this.node)\r\n            .call(() => {\r\n                this.node.getComponent(cc.Sprite).spriteFrame = this.explodeFx;\r\n                \r\n            })\r\n            .delay(0.5)\r\n            .call(() => {\r\n                this.node.destroy();\r\n            })\r\n            .delay(0.5)\r\n            .call(() => {\r\n                this.loadScreenGameOver();\r\n                \r\n            })\r\n            .start();\r\n            \r\n    },\r\n    loadScreenGameOver() {\r\n        let level = this.node.parent.getChildByName('WaveManager').getComponent('WaveMng').getLevelIndex();\r\n        cc.director.loadScene(\"Menu\", (() => {\r\n            cc.log('1');\r\n            mEmitter.instance.emit('changeScreen', 'gameover');\r\n            let getLevelScore = cc.director.getScene().getChildByName('Canvas').getChildByName('GameOverNode').getComponent('GameOver');\r\n            getLevelScore.setLevel(level);\r\n        }));\r\n    },\r\n    update(dt) {\r\n        let currentPos = this.node.position;\r\n        let delta = this._tmpPos.sub(currentPos);\r\n        let distance = delta.magSqr();\r\n\r\n        let maxSpeedPerFrame = this.maxSpeed * dt;\r\n        if (distance > maxSpeedPerFrame * maxSpeedPerFrame) {\r\n            delta.normalizeSelf();\r\n            delta.mulSelf(maxSpeedPerFrame);\r\n        }\r\n\r\n        this.node.position = this.node.position.add(delta);\r\n\r\n        let screen = cc.Canvas.instance.node.getContentSize();\r\n        this.node.x = cc.misc.clampf(this.node.x, -screen.width / 2, screen.width / 2);\r\n        this.node.y = cc.misc.clampf(this.node.y, -screen.height / 2, screen.height / 2);\r\n    },\r\n\r\n    onDestroy() {\r\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n});\r\n"]}