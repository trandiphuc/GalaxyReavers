{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","maxSpeed","onLoad","_tmpPos","node","position","Canvas","instance","on","Node","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","event","touches","getTouches","moving","getDelta","addSelf","onCollisionEnter","other","self","group","die","destroy","update","dt","currentPos","delta","sub","distance","magSqr","maxSpeedPerFrame","normalizeSelf","mulSelf","add","screen","getContentSize","x","misc","clampf","width","y","height","onDestroy","off"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,kBAAU;AADF,KAHP;;AAOLC,UAPK,oBAOI;AACL,aAAKC,OAAL,GAAe,KAAKC,IAAL,CAAUC,QAAzB;AACAT,WAAGU,MAAH,CAAUC,QAAV,CAAmBH,IAAnB,CAAwBI,EAAxB,CAA2BZ,GAAGa,IAAH,CAAQC,SAAR,CAAkBC,UAA7C,EAAyD,KAAKC,WAA9D,EAA2E,IAA3E;AACAhB,WAAGU,MAAH,CAAUC,QAAV,CAAmBH,IAAnB,CAAwBI,EAAxB,CAA2BZ,GAAGa,IAAH,CAAQC,SAAR,CAAkBG,SAA7C,EAAwD,KAAKC,UAA7D,EAAyE,IAAzE;AACH,KAXI;AAaLF,eAbK,uBAaOG,KAbP,EAac;AACf,YAAIC,UAAUD,MAAME,UAAN,EAAd;AACA,YAAIC,SAASF,QAAQ,CAAR,EAAWG,QAAX,EAAb;AACA,aAAKhB,OAAL,CAAaiB,OAAb,CAAqBF,MAArB;AACH,KAjBI;AAmBLJ,cAnBK,wBAmBQ;AACT,aAAKX,OAAL,GAAe,KAAKC,IAAL,CAAUC,QAAzB;AACH,KArBI;AAuBLgB,oBAvBK,4BAuBYC,KAvBZ,EAuBmBC,IAvBnB,EAuByB;AAC1B,YAAID,MAAMlB,IAAN,CAAWoB,KAAX,KAAqB,OAArB,IAAgCF,MAAMlB,IAAN,CAAWoB,KAAX,KAAqB,cAAzD,EAAyE;AACrE,iBAAKC,GAAL;AACH;AACJ,KA3BI;AA6BLA,OA7BK,iBA6BC;AACF,aAAKrB,IAAL,CAAUsB,OAAV;AACH,KA/BI;AAiCLC,UAjCK,kBAiCEC,EAjCF,EAiCM;AACP,YAAIC,aAAa,KAAKzB,IAAL,CAAUC,QAA3B;AACA,YAAIyB,QAAQ,KAAK3B,OAAL,CAAa4B,GAAb,CAAiBF,UAAjB,CAAZ;AACA,YAAIG,WAAWF,MAAMG,MAAN,EAAf;;AAEA,YAAIC,mBAAmB,KAAKjC,QAAL,GAAgB2B,EAAvC;AACA,YAAII,WAAWE,mBAAmBA,gBAAlC,EAAoD;AAChDJ,kBAAMK,aAAN;AACAL,kBAAMM,OAAN,CAAcF,gBAAd;AACH;;AAED,aAAK9B,IAAL,CAAUC,QAAV,GAAqB,KAAKD,IAAL,CAAUC,QAAV,CAAmBgC,GAAnB,CAAuBP,KAAvB,CAArB;;AAEA,YAAIQ,SAAS1C,GAAGU,MAAH,CAAUC,QAAV,CAAmBH,IAAnB,CAAwBmC,cAAxB,EAAb;AACA,aAAKnC,IAAL,CAAUoC,CAAV,GAAc5C,GAAG6C,IAAH,CAAQC,MAAR,CAAe,KAAKtC,IAAL,CAAUoC,CAAzB,EAA4B,CAACF,OAAOK,KAAR,GAAgB,CAA5C,EAA+CL,OAAOK,KAAP,GAAe,CAA9D,CAAd;AACA,aAAKvC,IAAL,CAAUwC,CAAV,GAAchD,GAAG6C,IAAH,CAAQC,MAAR,CAAe,KAAKtC,IAAL,CAAUwC,CAAzB,EAA4B,CAACN,OAAOO,MAAR,GAAiB,CAA7C,EAAgDP,OAAOO,MAAP,GAAgB,CAAhE,CAAd;AACH,KAjDI;AAmDLC,aAnDK,uBAmDO;AACRlD,WAAGU,MAAH,CAAUC,QAAV,CAAmBH,IAAnB,CAAwB2C,GAAxB,CAA4BnD,GAAGa,IAAH,CAAQC,SAAR,CAAkBC,UAA9C,EAA0D,KAAKC,WAA/D,EAA4E,IAA5E;AACAhB,WAAGU,MAAH,CAAUC,QAAV,CAAmBH,IAAnB,CAAwB2C,GAAxB,CAA4BnD,GAAGa,IAAH,CAAQC,SAAR,CAAkBG,SAA9C,EAAyD,KAAKC,UAA9D,EAA0E,IAA1E;AACH;AAtDI,CAAT","file":"Player.js","sourceRoot":"../../../../../assets/Script/Actor","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        maxSpeed: 10,\n    },\n\n    onLoad() {\n        this._tmpPos = this.node.position;\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n    },\n\n    onTouchMove(event) {\n        let touches = event.getTouches();\n        let moving = touches[0].getDelta();\n        this._tmpPos.addSelf(moving);\n    },\n\n    onTouchEnd() {\n        this._tmpPos = this.node.position;\n    },\n\n    onCollisionEnter(other, self) {\n        if (other.node.group === 'enemy' || other.node.group === 'enemy_bullet') {\n            this.die();\n        }\n    },\n\n    die() {\n        this.node.destroy();\n    },\n\n    update(dt) {\n        let currentPos = this.node.position;\n        let delta = this._tmpPos.sub(currentPos);\n        let distance = delta.magSqr();\n\n        let maxSpeedPerFrame = this.maxSpeed * dt;\n        if (distance > maxSpeedPerFrame * maxSpeedPerFrame) {\n            delta.normalizeSelf();\n            delta.mulSelf(maxSpeedPerFrame);\n        }\n\n        this.node.position = this.node.position.add(delta);\n\n        let screen = cc.Canvas.instance.node.getContentSize();\n        this.node.x = cc.misc.clampf(this.node.x, -screen.width / 2, screen.width / 2);\n        this.node.y = cc.misc.clampf(this.node.y, -screen.height / 2, screen.height / 2);\n    },\n\n    onDestroy() {\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n    }\n});\n"]}