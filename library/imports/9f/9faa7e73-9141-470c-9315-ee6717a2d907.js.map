{"version":3,"sources":["../../../../../assets/Script/Actor/assets/Script/Actor/Player.js"],"names":["mEmitter","require","cc","Class","extends","Component","properties","maxSpeed","level","onLoad","node","_parent","name","_tmpPos","position","Canvas","instance","on","Node","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","event","touches","getTouches","moving","getDelta","addSelf","onCollisionEnter","other","self","group","die","parent","getChildByName","getComponent","getLevelIndex","director","loadScene","emit","getLevelScore","getScene","setLevel","destroy","update","dt","currentPos","delta","sub","distance","magSqr","maxSpeedPerFrame","normalizeSelf","mulSelf","add","screen","getContentSize","x","misc","clampf","width","y","height","onDestroy","off"],"mappings":"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","file":"Player.js","sourceRoot":"../../../../../assets/Script/Actor","sourcesContent":["const mEmitter = require(\"Emitter\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        maxSpeed: 10,\n        level: \"\",\n    },\n\n    onLoad() {\n        this.level = this.node._parent.name;\n        this._tmpPos = this.node.position;\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n    },\n\n    onTouchMove(event) {\n        let touches = event.getTouches();\n        let moving = touches[0].getDelta();\n        this._tmpPos.addSelf(moving);\n    },\n\n    onTouchEnd() {\n        this._tmpPos = this.node.position;\n    },\n\n    onCollisionEnter(other, self) {\n        if (other.node.group === 'enemy' || other.node.group === 'enemy_bullet') {\n            this.die();\n        }\n    },\n\n    die() {\n        let level = this.node.parent.getChildByName('WaveManager').getComponent('WaveMng').getLevelIndex();\n        cc.director.loadScene(\"Menu\", (()=>{\n            mEmitter.instance.emit('changeScreen', 'gameover');\n            let getLevelScore = cc.director.getScene().getChildByName('Canvas').getChildByName('GameOverNode').getComponent('GameOver');\n            getLevelScore.setLevel(level);\n        }));\n        this.node.destroy();\n    },\n    \n    update(dt) {\n        let currentPos = this.node.position;\n        let delta = this._tmpPos.sub(currentPos);\n        let distance = delta.magSqr();\n\n        let maxSpeedPerFrame = this.maxSpeed * dt;\n        if (distance > maxSpeedPerFrame * maxSpeedPerFrame) {\n            delta.normalizeSelf();\n            delta.mulSelf(maxSpeedPerFrame);\n        }\n\n        this.node.position = this.node.position.add(delta);\n\n        let screen = cc.Canvas.instance.node.getContentSize();\n        this.node.x = cc.misc.clampf(this.node.x, -screen.width / 2, screen.width / 2);\n        this.node.y = cc.misc.clampf(this.node.y, -screen.height / 2, screen.height / 2);\n    },\n\n    onDestroy() {\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n    }\n});\n"]}