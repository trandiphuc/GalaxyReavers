{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Actor/assets\\Script\\Actor\\Player.js"],"names":["mEmitter","require","cc","Class","extends","Component","properties","maxSpeed","level","explodeFx","SpriteFrame","onLoad","node","_parent","name","_tmpPos","position","Canvas","instance","on","Node","EventType","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","event","touches","getTouches","moving","getDelta","addSelf","onCollisionEnter","other","self","group","die","parent","getChildByName","getComponent","getLevelIndex","tween","call","Sprite","spriteFrame","delay","director","loadScene","emit","getLevelScore","getScene","setLevel","destroy","start","update","dt","currentPos","delta","sub","distance","magSqr","maxSpeedPerFrame","normalizeSelf","mulSelf","add","screen","getContentSize","x","misc","clampf","width","y","height","onDestroy","off"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Actor","sourcesContent":["const mEmitter = require(\"Emitter\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        maxSpeed: 10,\r\n        level: \"\",\r\n        explodeFx: cc.SpriteFrame,\r\n    },\r\n\r\n    onLoad() {\r\n        this.level = this.node._parent.name;\r\n        this._tmpPos = this.node.position;\r\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        cc.Canvas.instance.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    },\r\n\r\n    onTouchMove(event) {\r\n        let touches = event.getTouches();\r\n        let moving = touches[0].getDelta();\r\n        this._tmpPos.addSelf(moving);\r\n    },\r\n\r\n    onTouchEnd() {\r\n        this._tmpPos = this.node.position;\r\n    },\r\n\r\n    onCollisionEnter(other, self) {\r\n        if (other.node.group === 'enemy' || other.node.group === 'enemy_bullet') {\r\n            this.die();\r\n        }\r\n    },\r\n\r\n    die() {\r\n        let level = this.node.parent.getChildByName('WaveManager').getComponent('WaveMng').getLevelIndex();\r\n        cc.tween(this.node)\r\n            .call(() => {\r\n                this.node.getComponent(cc.Sprite).spriteFrame = this.explodeFx;\r\n            })\r\n            .delay(1)\r\n            .call(() => {\r\n                cc.director.loadScene(\"Menu\", (() => {\r\n                    mEmitter.instance.emit('changeScreen', 'gameover');\r\n                    let getLevelScore = cc.director.getScene().getChildByName('Canvas').getChildByName('GameOverNode').getComponent('GameOver');\r\n                    getLevelScore.setLevel(level);\r\n                }));\r\n                this.node.destroy();\r\n            })\r\n            .start();\r\n    },\r\n\r\n    update(dt) {\r\n        let currentPos = this.node.position;\r\n        let delta = this._tmpPos.sub(currentPos);\r\n        let distance = delta.magSqr();\r\n\r\n        let maxSpeedPerFrame = this.maxSpeed * dt;\r\n        if (distance > maxSpeedPerFrame * maxSpeedPerFrame) {\r\n            delta.normalizeSelf();\r\n            delta.mulSelf(maxSpeedPerFrame);\r\n        }\r\n\r\n        this.node.position = this.node.position.add(delta);\r\n\r\n        let screen = cc.Canvas.instance.node.getContentSize();\r\n        this.node.x = cc.misc.clampf(this.node.x, -screen.width / 2, screen.width / 2);\r\n        this.node.y = cc.misc.clampf(this.node.y, -screen.height / 2, screen.height / 2);\r\n    },\r\n\r\n    onDestroy() {\r\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        cc.Canvas.instance.node.off(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n});\r\n"]}