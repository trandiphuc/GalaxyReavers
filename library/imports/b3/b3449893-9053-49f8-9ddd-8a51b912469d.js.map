{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Actor/assets\\Script\\Actor\\BulletsPool.js"],"names":["Emitter","require","bullet","cc","Class","extends","Component","properties","onLoad","pool","NodePool","bullets","instance","registerEvent","add","bind","remove","prefab","position","bulletNode","get","instantiate","active","getComponent","push","subSelf","node","parent","js","array","put","update","dt","screenSize","Canvas","getContentSize","top","height","bottom","right","width","left","i","length","bulletPos","addSelf","speed","mul","outScreen","x","y"],"mappings":";;;;;;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAIC,SAASD,QAAQ,QAAR,CAAb;AACAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY,EAHP;;AAOLC,UAPK,oBAOI;AACL,aAAKC,IAAL,GAAY,IAAIN,GAAGO,QAAP,CAAgB,QAAhB,CAAZ;AACA,aAAKC,OAAL,GAAe,EAAf;AACAX,gBAAQY,QAAR,CAAiBC,aAAjB,CAA+B,MAA/B,EAAuC,KAAKC,GAAL,CAASC,IAAT,CAAc,IAAd,CAAvC;AACAf,gBAAQY,QAAR,CAAiBC,aAAjB,CAA+B,QAA/B,EAAyC,KAAKG,MAAL,CAAYD,IAAZ,CAAiB,IAAjB,CAAzC;AACH,KAZI;AAcLD,OAdK,eAcDG,MAdC,EAcOC,QAdP,EAciB;AAClB,YAAIC,aAAa,KAAKV,IAAL,CAAUW,GAAV,EAAjB;AACA,YAAI,CAACD,UAAL,EAAiB;AACbA,yBAAahB,GAAGkB,WAAH,CAAeJ,MAAf,CAAb;AACH;AACDE,mBAAWG,MAAX,GAAoB,IAApB;AACA,YAAIpB,SAASiB,WAAWI,YAAX,CAAwB,QAAxB,CAAb;AACA,aAAKZ,OAAL,CAAaa,IAAb,CAAkBtB,MAAlB;AACA;AACAgB,iBAASO,OAAT,CAAiB,KAAKC,IAAL,CAAUC,MAAV,CAAiBT,QAAlC;AACAhB,eAAOwB,IAAP,CAAYR,QAAZ,GAAuBA,QAAvB;AACA;AACAhB,eAAOwB,IAAP,CAAYC,MAAZ,GAAqB,KAAKD,IAA1B;AACH,KA3BI;AA6BLV,UA7BK,kBA6BEd,MA7BF,EA6BU;AACXA,eAAOwB,IAAP,CAAYJ,MAAZ,GAAqB,KAArB;AACAnB,WAAGyB,EAAH,CAAMC,KAAN,CAAYb,MAAZ,CAAmB,KAAKL,OAAxB,EAAiCT,MAAjC;AACA,aAAKO,IAAL,CAAUqB,GAAV,CAAc5B,OAAOwB,IAArB;AACH,KAjCI;AAmCLK,UAnCK,kBAmCEC,EAnCF,EAmCM;AACP,YAAIC,aAAa9B,GAAG+B,MAAH,CAAUtB,QAAV,CAAmBc,IAAnB,CAAwBS,cAAxB,EAAjB;AACA,YAAIC,MAAMH,WAAWI,MAAX,IAAqB,CAA/B;AACA,YAAIC,SAAS,CAACF,GAAd;AACA,YAAIG,QAAQN,WAAWO,KAAX,IAAoB,CAAhC;AACA,YAAIC,OAAO,CAACF,KAAZ;;AAEA,YAAI5B,UAAU,KAAKA,OAAnB;AACA,aAAI,IAAI+B,IAAI,CAAZ,EAAeA,IAAI/B,QAAQgC,MAA3B,EAAmCD,GAAnC,EAAuC;AACnC,gBAAIxC,UAASS,QAAQ+B,CAAR,CAAb;AACA,gBAAIE,YAAY1C,QAAOwB,IAAP,CAAYR,QAA5B;AACA0B,sBAAUC,OAAV,CAAkB3C,QAAO4C,KAAP,CAAaC,GAAb,CAAiBf,EAAjB,CAAlB;;AAEA,gBAAIgB,YAAYJ,UAAUK,CAAV,GAAcR,IAAd,IAAsBG,UAAUK,CAAV,GAAcV,KAApC,IAA6CK,UAAUM,CAAV,GAAcZ,MAA3D,IAAqEM,UAAUM,CAAV,GAAcd,GAAnG;AACA,gBAAGY,SAAH,EAAa;AACT,qBAAKhC,MAAL,CAAYd,OAAZ;AACA;AACH;AACDA,oBAAOwB,IAAP,CAAYR,QAAZ,GAAuB0B,SAAvB;AACH;AAEJ;AAxDI,CAAT","file":"BulletsPool.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Actor","sourcesContent":["const Emitter = require('Emitter');\r\nlet bullet = require('Bullet');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    onLoad() {\r\n        this.pool = new cc.NodePool('bullet');\r\n        this.bullets = [];\r\n        Emitter.instance.registerEvent('fire', this.add.bind(this));\r\n        Emitter.instance.registerEvent('remove', this.remove.bind(this));\r\n    },\r\n\r\n    add(prefab, position) {\r\n        let bulletNode = this.pool.get();\r\n        if (!bulletNode) {\r\n            bulletNode = cc.instantiate(prefab);\r\n        }\r\n        bulletNode.active = true;\r\n        let bullet = bulletNode.getComponent('Bullet');\r\n        this.bullets.push(bullet);\r\n        // // convert position to local space\r\n        position.subSelf(this.node.parent.position);\r\n        bullet.node.position = position;\r\n        // // add to scene\r\n        bullet.node.parent = this.node;\r\n    },\r\n\r\n    remove(bullet) {\r\n        bullet.node.active = false;\r\n        cc.js.array.remove(this.bullets, bullet);\r\n        this.pool.put(bullet.node);\r\n    },\r\n\r\n    update(dt) {\r\n        let screenSize = cc.Canvas.instance.node.getContentSize();\r\n        let top = screenSize.height >> 1;\r\n        let bottom = -top;\r\n        let right = screenSize.width >> 1;\r\n        let left = -right;\r\n\r\n        let bullets = this.bullets;\r\n        for(let i = 0; i < bullets.length; i++){\r\n            let bullet = bullets[i];\r\n            let bulletPos = bullet.node.position;\r\n            bulletPos.addSelf(bullet.speed.mul(dt));\r\n\r\n            let outScreen = bulletPos.x < left || bulletPos.x > right || bulletPos.y < bottom || bulletPos.y > top;\r\n            if(outScreen){\r\n                this.remove(bullet);\r\n                continue;\r\n            }\r\n            bullet.node.position = bulletPos;\r\n        }\r\n\r\n    },\r\n});\r\n"]}